# .github/workflows/generate_data.yml

name: Generate AI Summaries and Data

on:
  # 💡 スケジュール: 毎日、日本時間午前10時に実行（UTCで午前1時）
  schedule:
    - cron: '0 1 * * *' 
  # 💡 Actionsタブから手動で実行できるようにする
  workflow_dispatch:

jobs:
  generate:
    # 実行環境はUbuntu Linuxを使う
    runs-on: ubuntu-latest
    
    steps:
      # 1. リポジトリのコード（generate_data.jsなど）をチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 2. Node.js (JavaScriptの実行環境) をセットアップ
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      # 3. 必要なライブラリのインストール
      - name: Install dependencies (Google GenAI, node-fetch, cheerio, etc.)
        # 💡 ここで使いたい外部ライブラリを全て npm install する
        run: npm install @google/genai node-fetch cheerio xml2js 
        
      # 4. メインのデータ生成スクリプトを実行
      - name: Run data generation script
        # 🚨 GEMINI_API_KEYを環境変数として渡す
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: node generate_data.js
        
      # 5. 生成された data.json をリポジトリにコミット（更新）
      - name: Commit data.json changes
        # 💡 stefanzweifel/git-auto-commit-action という便利なActionを使う
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '🤖 Auto: Update data.json with new AI summaries'
          files: data.json # data.jsonファイルだけをコミット対象にする
          # 💡 このアクションが使うGitの認証情報を設定
          commit_author: 'github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>'
