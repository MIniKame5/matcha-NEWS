# .github/workflows/generate_data.yml

name: Generate AI Summaries and Data

on:
  # ğŸ’¡ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: æ¯æ—¥ã€æ—¥æœ¬æ™‚é–“åˆå‰10æ™‚ã«å®Ÿè¡Œï¼ˆUTCã§åˆå‰1æ™‚ï¼‰
  schedule:
    - cron: '0 1 * * *' 
  # ğŸ’¡ Actionsã‚¿ãƒ–ã‹ã‚‰æ‰‹å‹•ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  workflow_dispatch:

jobs:
  generate:
    # å®Ÿè¡Œç’°å¢ƒã¯Ubuntu Linuxã‚’ä½¿ã†
    runs-on: ubuntu-latest
    
    steps:
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ï¼ˆgenerate_data.jsãªã©ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 2. Node.js (JavaScriptã®å®Ÿè¡Œç’°å¢ƒ) ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      # 3. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies (Google GenAI, node-fetch, cheerio, etc.)
        # ğŸ’¡ ã“ã“ã§ä½¿ã„ãŸã„å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¨ã¦ npm install ã™ã‚‹
        run: npm install @google/genai node-fetch cheerio xml2js 
        
      # 4. ãƒ¡ã‚¤ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
      - name: Run data generation script
        # ğŸš¨ GEMINI_API_KEYã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æ¸¡ã™
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: node generate_data.js
        
      # 5. ç”Ÿæˆã•ã‚ŒãŸ data.json ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆï¼ˆæ›´æ–°ï¼‰
      - name: Commit data.json changes
        # ğŸ’¡ stefanzweifel/git-auto-commit-action ã¨ã„ã†ä¾¿åˆ©ãªActionã‚’ä½¿ã†
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ¤– Auto: Update data.json with new AI summaries'
          files: data.json # data.jsonãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’ã‚³ãƒŸãƒƒãƒˆå¯¾è±¡ã«ã™ã‚‹
          # ğŸ’¡ ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒä½¿ã†Gitã®èªè¨¼æƒ…å ±ã‚’è¨­å®š
          commit_author: 'github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>'
